version: '3'
services:
  rabbit:
    image: rabbitmq:3-management
    ports:
      - "15672:15672"
      - "5672:5672"
      - "5671:5671"
      - "9090:9090"

  coordinator:
    build:
      context: ./coordinator
    restart: on-failure

  boiler-temp:
    build:
      context: ./sensors
    environment:
      NAME: "boiler-temp"
      FREQ: "5"
      MAX: "450.0"
      MIN: "250.0"
      STEP: "9.0"
    restart: on-failure

  boiler-pressure:
    build:
      context: ./sensors
    environment:
      NAME: "boiler-pressure"
      FREQ: "5"
      MAX: "15"
      MIN: "3"
      STEP: "0.3"
    restart: on-failure

  boiler-current:
    build:
      context: ./sensors
    environment:
      NAME: "boiler-current"
      FREQ: "5"
      MAX: "50.0"
      MIN: "20.0"
      STEP: "1.0"
    restart: on-failure

  boiler-mixer:
    build:
      context: ./sensors
    environment:
      NAME: "boiler-mixer"
      FREQ: "5"
      MAX: "150.0"
      MIN: "90.0"
      STEP: "3.0"
    restart: on-failure

  rabbit-exporter:
    image: kbudde/rabbitmq-exporter
    network_mode: "service:rabbit"